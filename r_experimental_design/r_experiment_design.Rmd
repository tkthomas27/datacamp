---
title: "Datacamp: Experiment Design in R"
output: html_notebook
---

```{r}
library(tidyverse)
```

Comparing differences in sepal length across species in the iris dataset.

First visualize,

```{r}
ggplot(iris, aes(Species, Sepal.Length)) + geom_boxplot() + theme_minimal()
```

# t Test

```{r}
iris2 <- iris[iris$Species!="setosa",]

ttest_results <- t.test(Sepal.Length ~ Species, data = iris2)

library(broom)
tidy(ttest_results)
```

# Power Test

How to choose effect size?

```{r}
library(effsize)

#cohens d
cohend <- cohen.d(iris2$Sepal.Length, iris2$Species)

#load the pwr package
library(pwr)

iris_size <- nrow(iris2)

#calculate power
pwr.t.test(n = iris_size, 
           d = abs(cohend$estimate),
           sig.level = 0.05,
           type = "two.sample", 
           alternative = "two.sided",
           power = NULL)
```


# ANOVA

```{r}
#anova via aov
aov_results <- aov(Sepal.Length ~ Species, data = iris)

#alternatively
lm_results <- lm(Sepal.Length ~ Species, data = iris)
anova_results <- anova(lm_results)

```

```{r}
#Conduct Tukey's HSD test to create tukey_output
tukey_output <- TukeyHSD(aov_results, conf.level = 0.95)

#tidy tukey_output to make sense of the results
broom::tidy(tukey_output)
```


```{r}
#for a 2x2 grid of plots:
par(mfrow=c(2, 2))

#plot grade_aov
plot(anova_results)
```

```{r}
#Bartlett's test for homogeneity of variance
bartlett.test(int_rate ~ grade, data = lendingclub)

#conduct the Kruskal-Wallis rank sum test
kruskal.test(int_rate ~ as.factor(grade),
             data = lendingclub)

```


# Sampling

1. Simple Random Sampling: everyone has same probability of being sampled, `sample()`
1. Stratified Sampling: spitting by groups, then simple sampling; `group_by` then `sample_n()`
1. Cluster Sampling: split into clusters, randomly pick clusters, then sample from clusters; `sampling::cluster()`
1. Systematic Sampling: every 5th or 12th etc.
1. Multi-stage Sampling: combines above methods


REduce function?

```{r}
library(haven)
nhanes_demo <- read_xpt(DEMO_file)
nhanes_medical <- read_xpt(MCQ_file)
nhanes_bodymeasures <- read_xpt(BMX_file)

#merge the 3 datasets you just created to create nhanes_combined
nhanes_combined <- list(nhanes_demo, nhanes_medical, nhanes_bodymeasures) %>%
  Reduce(function(df1,df2) inner_join(df1,df2,by="SEQN"), .)
```

